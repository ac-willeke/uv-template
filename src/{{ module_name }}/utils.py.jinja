"""
Utility functions for {{ project_name }}.

This module contains helper functions and utilities that support
the main functionality of {{ package_name }}.
"""

import logging
from pathlib import Path
from typing import Any, Dict, List, Optional, Union

logger = logging.getLogger(__name__)


def setup_logging(
    level: str = "INFO",
    format_string: Optional[str] = None
) -> None:
    """
    Set up logging configuration for {{ package_name }}.
    
    :param level: Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL).
    :param format_string: Custom format string for log messages.
    """
    if format_string is None:
        format_string = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    
    logging.basicConfig(
        level=getattr(logging, level.upper()),
        format=format_string,
        datefmt="%Y-%m-%d %H:%M:%S"
    )
    logger.info("Logging configured for {{ package_name }}")


def validate_input(
    data: Any,
    expected_type: type,
    allow_none: bool = False
) -> bool:
    """
    Validate input data type.
    
    :param data: Data to validate.
    :param expected_type: Expected data type.
    :param allow_none: Whether to allow None values.
    :return: True if validation passes, False otherwise.
    """
    if data is None and allow_none:
        return True
    
    if not isinstance(data, expected_type):
        logger.warning(
            "VALIDATION FAILED: Expected %s, got %s",
            expected_type.__name__,
            type(data).__name__
        )
        return False
    
    return True


def read_config_file(file_path: Union[str, Path]) -> Dict[str, Any]:
    """
    Read configuration from a file.
    
    Supports JSON and basic key=value format files.
    
    :param file_path: Path to configuration file.
    :return: Configuration dictionary.
    :raises FileNotFoundError: If file doesn't exist.
    :raises ValueError: If file format is not supported.
    """
    import json
    
    path = Path(file_path)
    if not path.exists():
        raise FileNotFoundError(f"Configuration file not found: {path}")
    
    content = path.read_text(encoding="utf-8")
    
    # Try JSON first
    try:
        config = json.loads(content)
        logger.info("LOADED JSON CONFIG: %s", path)
        return config
    except json.JSONDecodeError:
        pass
    
    # Try key=value format
    config = {}
    for line_num, line in enumerate(content.splitlines(), 1):
        line = line.strip()
        if not line or line.startswith("#"):
            continue
        
        if "=" not in line:
            continue
        
        key, value = line.split("=", 1)
        config[key.strip()] = value.strip()
    
    if config:
        logger.info("LOADED KEY-VALUE CONFIG: %s", path)
        return config
    
    raise ValueError(f"Unsupported configuration file format: {path}")


def safe_divide(a: float, b: float, default: float = 0.0) -> float:
    """
    Safely divide two numbers, handling division by zero.
    
    :param a: Dividend.
    :param b: Divisor.
    :param default: Default value if division by zero.
    :return: Result of division or default value.
    """
    try:
        return a / b
    except ZeroDivisionError:
        logger.warning("DIVISION BY ZERO: %f / %f, returning default: %f", a, b, default)
        return default


def filter_and_sort(
    items: List[str],
    filter_empty: bool = True,
    sort_items: bool = True
) -> List[str]:
    """
    Filter and optionally sort a list of strings.
    
    :param items: List of strings to process.
    :param filter_empty: Whether to remove empty strings.
    :param sort_items: Whether to sort the results.
    :return: Processed list of strings.
    """
    result = items.copy()
    
    if filter_empty:
        result = [item.strip() for item in result if item.strip()]
        logger.debug("FILTERED %d empty items", len(items) - len(result))
    
    if sort_items:
        result.sort()
        logger.debug("SORTED %d items", len(result))
    
    return result