"""Tests for the core {{ module_name }} functionality."""

from typing import Dict, List
import pytest

from {{ module_name }}.core import {{ module_name.title().replace('_', '') }}, create_instance


class Test{{ module_name.title().replace('_', '') }}:
    """Test class for {{ module_name.title().replace('_', '') }}."""
    
    def test_initialization_default(self) -> None:
        """Test default initialization."""
        instance = {{ module_name.title().replace('_', '') }}()
        assert instance.name == "{{ project_name }}"
        assert instance._config == {}
    
    def test_initialization_custom_name(self) -> None:
        """Test initialization with custom name."""
        custom_name = "test_instance"
        instance = {{ module_name.title().replace('_', '') }}(custom_name)
        assert instance.name == custom_name
        assert instance._config == {}
    
    def test_configure_single_value(self) -> None:
        """Test configuring with a single key-value pair."""
        instance = {{ module_name.title().replace('_', '') }}()
        instance.configure(key1="value1")
        
        assert instance._config["key1"] == "value1"
        assert len(instance._config) == 1
    
    def test_configure_multiple_values(self) -> None:
        """Test configuring with multiple key-value pairs."""
        instance = {{ module_name.title().replace('_', '') }}()
        instance.configure(key1="value1", key2="value2", key3="value3")
        
        assert instance._config["key1"] == "value1"
        assert instance._config["key2"] == "value2"
        assert instance._config["key3"] == "value3"
        assert len(instance._config) == 3
    
    def test_configure_update_existing(self) -> None:
        """Test that configure updates existing values."""
        instance = {{ module_name.title().replace('_', '') }}()
        instance.configure(key1="initial_value")
        instance.configure(key1="updated_value")
        
        assert instance._config["key1"] == "updated_value"
        assert len(instance._config) == 1
    
    def test_get_config_existing_key(self) -> None:
        """Test getting an existing configuration value."""
        instance = {{ module_name.title().replace('_', '') }}()
        instance.configure(test_key="test_value")
        
        result = instance.get_config("test_key")
        assert result == "test_value"
    
    def test_get_config_missing_key(self) -> None:
        """Test getting a missing configuration value."""
        instance = {{ module_name.title().replace('_', '') }}()
        
        result = instance.get_config("missing_key")
        assert result is None
    
    def test_get_config_missing_key_with_default(self) -> None:
        """Test getting a missing configuration value with default."""
        instance = {{ module_name.title().replace('_', '') }}()
        default_value = "default"
        
        result = instance.get_config("missing_key", default_value)
        assert result == default_value
    
    def test_process_data_basic(self, sample_data: List[str]) -> None:
        """Test basic data processing functionality."""
        instance = {{ module_name.title().replace('_', '') }}()
        
        result = instance.process_data(sample_data)
        
        # Check that empty strings are filtered out
        assert "" not in result
        
        # Check that strings are stripped and uppercase
        assert "HELLO WORLD" in result
        assert "PYTHON TESTING" in result
        assert "{{ package_name.upper() }}" in result
        assert "UNIT TESTS" in result
    
    def test_process_data_empty_list(self) -> None:
        """Test processing an empty list."""
        instance = {{ module_name.title().replace('_', '') }}()
        
        result = instance.process_data([])
        assert result == []
    
    def test_process_data_whitespace_only(self) -> None:
        """Test processing list with only whitespace strings."""
        instance = {{ module_name.title().replace('_', '') }}()
        data = ["  ", "\t", "\n", "   \t\n   "]
        
        result = instance.process_data(data)
        assert result == []
    
    def test_repr_method(self) -> None:
        """Test string representation of the instance."""
        instance = {{ module_name.title().replace('_', '') }}("test_name")
        repr_str = repr(instance)
        
        assert "{{ module_name.title().replace('_', '') }}" in repr_str
        assert "test_name" in repr_str
        assert repr_str == "{{ module_name.title().replace('_', '') }}(name='test_name')"


class TestCreateInstance:
    """Test class for the create_instance factory function."""
    
    def test_create_instance_default(self) -> None:
        """Test creating an instance with default name."""
        instance = create_instance()
        
        assert isinstance(instance, {{ module_name.title().replace('_', '') }})
        assert instance.name == "default"
    
    def test_create_instance_custom_name(self) -> None:
        """Test creating an instance with custom name."""
        custom_name = "custom_test"
        instance = create_instance(custom_name)
        
        assert isinstance(instance, {{ module_name.title().replace('_', '') }})
        assert instance.name == custom_name
    
    def test_create_instance_multiple(self) -> None:
        """Test creating multiple instances."""
        instance1 = create_instance("instance1")
        instance2 = create_instance("instance2")
        
        assert instance1.name != instance2.name
        assert instance1 is not instance2


# Integration tests
class TestCoreIntegration:
    """Integration tests for core functionality."""
    
    def test_full_workflow(self, sample_data: List[str]) -> None:
        """Test a complete workflow with the core class."""
        # Create instance
        instance = create_instance("integration_test")
        
        # Configure it
        instance.configure(
            mode="test",
            environment="testing",
            debug="true"
        )
        
        # Verify configuration
        assert instance.get_config("mode") == "test"
        assert instance.get_config("environment") == "testing"
        assert instance.get_config("debug") == "true"
        
        # Process data
        result = instance.process_data(sample_data)
        
        # Verify processing
        assert len(result) > 0
        assert all(item.isupper() for item in result)
        assert "" not in result
    
    def test_configuration_persistence(self) -> None:
        """Test that configuration persists across method calls."""
        instance = {{ module_name.title().replace('_', '') }}()
        
        # Initial configuration
        instance.configure(persistent_key="persistent_value")
        
        # Add more configuration
        instance.configure(additional_key="additional_value")
        
        # Both should be present
        assert instance.get_config("persistent_key") == "persistent_value"
        assert instance.get_config("additional_key") == "additional_value"


@pytest.mark.parametrize("input_data,expected_count", [
    (["test", "data"], 2),
    (["  spaced  ", "normal"], 2),
    (["", "valid", ""], 1),
    ([], 0),
    (["  ", "valid", "  "], 1),
])
def test_process_data_parametrized(input_data: List[str], expected_count: int) -> None:
    """Test process_data with various inputs using parametrize."""
    instance = {{ module_name.title().replace('_', '') }}()
    result = instance.process_data(input_data)
    assert len(result) == expected_count